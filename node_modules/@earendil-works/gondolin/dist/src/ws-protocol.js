"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.OUTPUT_HEADER_BYTES = void 0;
exports.encodeOutputFrame = encodeOutputFrame;
exports.decodeOutputFrame = decodeOutputFrame;
exports.OUTPUT_HEADER_BYTES = 5;
function encodeOutputFrame(id, stream, data) {
    if (!Number.isInteger(id) || id < 0 || id > 0xffffffff) {
        throw new RangeError("id must be a uint32");
    }
    const header = Buffer.alloc(exports.OUTPUT_HEADER_BYTES);
    header.writeUInt8(stream === "stdout" ? 1 : 2, 0);
    header.writeUInt32BE(id, 1);
    return Buffer.concat([header, data]);
}
function decodeOutputFrame(frame) {
    if (frame.length < exports.OUTPUT_HEADER_BYTES) {
        throw new Error("output frame too short");
    }
    const streamFlag = frame.readUInt8(0);
    const stream = streamFlag === 1 ? "stdout" : "stderr";
    const id = frame.readUInt32BE(1);
    return {
        id,
        stream,
        data: frame.slice(exports.OUTPUT_HEADER_BYTES),
    };
}
//# sourceMappingURL=ws-protocol.js.map